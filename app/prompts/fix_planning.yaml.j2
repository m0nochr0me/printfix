description: Document Fix Orchestration
version: '2.0'
context:
  document_type: {{ file_type }}
  target_page_size: {{ target_page_size }}
agressiveness: {%- if aggressiveness == "conservative" -%}Only fix critical issues. Avoid changes that alter content appearance.
{%- elif aggressiveness == "moderate" -%}Fix critical and warning issues. Be cautious with content-affecting changes.
{%- elif aggressiveness == "aggressive" -%}Fix all issues including info-level. Apply all available improvements.
{%- else -%}Decide per issue â€” use aggressive for safe structural changes (margins, page size, orientation, blank pages), conservative for content-affecting changes (font substitution, table restructuring), and skip issues where the fix risks making things worse. Explain your reasoning for each decision.
{%- endif -%}
available_fix_tools:
  - docx:
    - set_margins(top, bottom, left, right): Set margins in inches on all sections
    - adjust_paragraph_indents(max_left_inches, max_right_inches, max_first_line_inches, strategy): Adjust paragraph indents with "cap" or "scale" strategy
    - set_page_size(width, height): Set page size in inches (A4=8.27x11.69, Letter=8.5x11)
    - set_orientation(orientation): Set "portrait" or "landscape"
    - remove_blank_pages(): Remove consecutive page breaks creating blank pages
    - replace_font(from_font, to_font): Replace all occurrences of a font
    - adjust_font_size(min_size_pt, max_size_pt): Clamp font sizes to range in points
    - auto_fit_tables(): Auto-fit all tables to page width
    - resize_table_text(table_index, max_font_size_pt): Reduce font in a specific table
    - resize_images_to_fit(max_width_pct, max_height_pct): Proportionally resize images that exceed the printable area (default 100% width, 90% height). Preserves aspect ratio.
    - fix_page_breaks(strategy): Fix breaks: "remove_consecutive" or "remove_all"
    - remove_manual_breaks(): Remove all manual page breaks
  - xlsx:
    - set_xlsx_margins(top, bottom, left, right): Set print margins in inches
    - set_xlsx_page_setup(orientation, paper_size, fit_to_page): Page setup (1=Letter, 9=A4)
    - auto_fit_xlsx_columns(max_col_width, min_col_width, shrink_margins): Auto-size columns to fit within a single page width, auto-selects orientation, tightens margins, and enables fit-to-page. Use when columns overflow onto additional pages.
  - pdf:
    - pdf_crop_margins(top, bottom, left, right): Adjust CropBox in inches inset
    - pdf_scale_content(scale_factor): Scale content (0.9 = shrink to 90%)
    - pdf_rotate_pages(pages, angle): Rotate pages (angle: 0/90/180/270, pages: 1-indexed list or null for all)
guidelines:
  - Order actions so that structural changes (margins, page size) come before \
  content changes (fonts, tables)
  - Do NOT apply the same tool twice with identical parameters
  - For DOCX documents, prefer DOCX tools first. Only use PDF fallback tools when DOCX tools have already failed for a given issue type (see "Fallback context" below if present). When using a PDF fallback tool for a DOCX document, set is_fallback=true in the action.
  - For PDF documents, use PDF tools directly (these are NOT fallbacks).
  - If an issue has no viable fix tool, skip it with an explanation
goal: Given a  diagnosis of print quality issues, select the appropriate fix tools and parameters to resolve them.